{% extends 'layout.html' %}

{% block title %}Shop{% endblock %}

{% block header %}Shop{% endblock %}

{% block content %}

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <link rel="stylesheet" href="./static/styles/shopping.css">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">


    <div class="container">
      <div class="navbar">
        <h1>SHOP</h1>
        <nav>
          <ul>
              <!-- <li><a href="/">Home</a></li> -->
              <li><a href="/shop"><img src="/static/shop.png" width="30px" height="30px"></a></li>
              <li><a href="/shoppingcart"><img src="/static/cart.png" width="30px" height="30px"></a></li>
              <li><a href="/boughtcart"><img src="/static/bought.png" width="30px" height="30px"></a></li>
          </ul>
        </nav>
      </div>
    </div>
    
    <!--------------Featured products-------------->
    <div class="small-container">
      <h2 class="title">Featured products</h2>
      <table class = "table col col-lg-11">
        <tr>
          <th class="col col-lg-10"></th>
          <th class="col col-lg-5">Filter by</th>
        </tr>
        <tr class="row">
          <td class="col col-lg-11">
            <div id="item_list" class="table">
                <!-- <div class="row"> -->
                  {%- for product in products %}
                  <table class="table">
                    <tr>
                      <td class="col col-lg-2"><a href="/itemdetails/{{product[0]}}"><img src="/static/images/{{product[3]}}" width="150px" height="150px"></a></td>
                      <td class="col col-lg-3">
                        <h2><a href="/itemdetails/{{product[0]}}">{{product[1]}}</a></h2>
                        <p>₹ {{product[2]}}</p>
                      </td>
                    </tr>
                  </table>
                  <br>
                  <br>
                  {% endfor -%}
                <!-- </div> -->
              </div>
            </td>

            <td class="col col-lg-5">
              <div class = "genres form-check form-control-lg">
                {%- for category in categories %}
                  <label>
                    <input class="form-check-input" type = "checkbox" name = "genre" value = "{{ category[1] }}">{{category[1]}}
                  </label>
                  <br>
                {% endfor -%}
                <button id = "filter_gen3" onclick= "filter('item_list')">Filter</button>
              </div>
            </td>

          </tr>
        </table>
    </div>

<script type="text/javascript">
  // on loading page
  $(document).ready(function(){
    var items;
    items = JSON.parse('{{ products | tojson | safe}}');
    // build_table("item_list", items);
  });

  function build_table(listname, items){
      var html = '';
      for (var j = 0; j < items.length; j++) {
        html += '<table class="table">';
        html += '<tr>';
        html += '<td class="col col-lg-2"><a href="/itemdetails/' + items[j][0] + '"><img src="/static/images/' + items[j][3] + '" width="150px" height="150px"></a></td>';
        html += '<h2><a href="/itemdetails/' + items[j][0] + '">' + items[j][1] + '</a></h2>';
        html += '<p>₹ ' + items[j][2] + '</p>';
        html += '</td>';
        html += '</tr>';
        html += '</table>';
        html += '<br><br>';
      }
      document.getElementById(listname).innerHTML = html;
    }

  function filter(listname){
      var checked = document.querySelectorAll("input[type=checkbox]:checked");
      var categories = [];
      for (var i = 0; i < checked.length; i++) {
        categories.push(checked[i].value);
        checked[i].checked = false;
      }
      var json_categories = JSON.stringify(categories);
      // var user = $('#inputUsername').val();
      // var pass = $('#inputPassword').val();
      // alert(typeof(json_genres));
      $.ajax({
        url: '/filterItems',
        type: 'POST',
        contentType: 'application/json',
        dataType : 'json',
        data : json_categories,
        success: function(data){
          build_table(listname, data);
        },
        error: function(error){
          console.log(error);
        }
      });
    }
</script>

{% endblock %}








