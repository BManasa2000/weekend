{% extends 'layout.html' %}

{% block title %}Upgrade{% endblock %}

{% block header %}Upgrade{% endblock %}

{% block content %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->
<link rel="stylesheet" type="text/css" href="/static/styles/upgrade.css">

<style type="text/css">
    #pay_div {
      width: 30%;
      text-align: center;
    }
</style>

  <div class="content-wrapper">
    <div class="container-fluid">
    
      <div id="member" class="alert alert-secondary" role="alert">
        You are currently a member of {{userTier[1]}} level.
      </div>

      <div id="info_msg" class="alert alert-info" role="alert" style="display: none;">
        You can only upgrade to a higher membership level:)
      </div>

      <div id="success_msg" class="alert alert-success" role="alert" style="display: none;">
        Successfully upgraded!
      </div>

      <!-- <button id = "Home" type="button" class="btn btn-secondary" onclick="home()">Home</button> -->
      <div class="row">

      <!-- Icon Cards-->
      {% for tier in tiers %}
        <div class="col-lg-4 col-md-4 col-sm-6 col-12 mb-2 mt-4" onclick='select({{ tier[0] }} , "{{ tier[1] }}" ,{{ tier[2] }})'>
            <div class="inforide">
              <div class="row">
                <div class="col-lg-3 col-md-4 col-sm-4 col-4 rideone">
                    <img src="/static/logo.jpg">
                </div>
                <div class="col-lg-9 col-md-8 col-sm-8 col-8 fontsty">
                    <h4>{{ tier[1] }}</h4>
                    <h2>{{ tier[2] }}</h2>
                </div>
              </div>
            </div>
        </div>
        {% endfor %}

        <br>
        <br>
        <br>
        <br>
        <br>

    </div>
    <div class="row">
        <div id = "pay_div" class = "container" style="display:none;">
        </div>
    </div>

  </div>
</div>

<script type="text/javascript">
    function home(){
        window.location.href = "http://127.0.0.1:5000/";
    }

    function select(id, tname, price) {
        var html = "";
        // alert(typeof(tname))
        html += "<div class='row'><h4> Tier : " + tname + "</h4></div>";
        html += "<div class='row'><h4> Price : " + price.toString() + "</h4></div>";
        html += '<button id = "' + id.toString() + '" type="button" class="btn btn-dark" onclick="pay(this)">Pay</button>';
        document.getElementById("pay_div").innerHTML = html;
        document.getElementById("pay_div").style.display = "block";
        // document.getElementById("pay_button").style.display = "block";
        // alert(typeof(id));
        // alert(typeof(price));
    }

    function pay(obj) {
        var tierID = obj.id;
        var tier = parseInt(tierID)
        var userTier = "{{userTier[0]}}"
        var user = parseInt(userTier)
        if (user >= tier)
        {
            document.getElementById("success_msg").style.display = "none";
            document.getElementById("pay_div").style.display = "none";
            document.getElementById("info_msg").style.display = "block";
        }
        else
        {
            var json_tierID = JSON.stringify(tierID.toString());
            $.ajax({
                 url: '/upgrade',
                 type: 'POST',
                 contentType: 'application/json',
                 dataType : 'json',
                 data : json_tierID,
                 success: function(data){                 
                    // alert(data)
                    var html = '';
                    html += "Congrats! You are now a member of " + data[1] + " level!";
                    document.getElementById("member").innerHTML = html;
                    document.getElementById("info_msg").style.display = "none";
                    document.getElementById("pay_div").style.display = "none";
                    document.getElementById("success_msg").style.display = "block";
                    // window.location.href = "http://127.0.0.1:5000/";
                 },
                 error: function(error){
                     alert(error);
                 }
             }); 
        }
    }
</script>

{% endblock %}


















